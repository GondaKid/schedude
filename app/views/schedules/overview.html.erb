<span class="contact1-form-title">
    YOUR SCHEDUDE
</span>
<div class="container">
    <div class="row">
        <div class="table-responsive">
            <table class="table table-hover table-bordered">
                <thead align="center">
                    <tr class="table-primary">
                        <th scope="col"></th>
                        <% @week.each do |w| %>
                        <th scope="col"><%= w %></th>
                        <% end %>
                    </tr>
                </thead>
                <tbody align="center">
                    <% (1..10).each do |t| %>
                    <tr>
                        <td><%= t %></td>
                        <% @sche.each do |sch| %>
                        <% puts "Sche================= #{sch} =========" %>
                          <% if sch.nil? %>
                            <td></td>
                            <% next %>
                          <% end %>
                          <% sch_exists = 0 %>
                          <% sch.each do |s| %>
                            <% next if not s.is_a?(Hash)%>
                            <% if s[:time] === t %>
                                <td><%= s[:name] %> (<%= s[:code] %>)</td>
                                <% sch_exists = 1 %>
                                <% break %>
                            <% end %>
                          <% end %>
                          <% if sch_exists == 0 %><td></td><% end %>
                        <% end %>
                    </tr>
                    <% end %>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row mb-3 mt-3">
        <%= link_to raw('<i class="fas fa-heart"></i>'), student_schedules_path(@student, schedule: @sche.flatten), method: :post %>
    </div>
    <%= form_for overview_student_schedule_path(@student), local: true do |f| %>
      <div class="row mb-3 mt-3">
        <h5>Exclude days</h5>
        <% @week.each do |day| %>
          <div class="form-check form-check-inline">
            <% if not @excluded_days.nil? and @excluded_days.any? day %>
              <%= check_box_tag 'exclude_days[]', day, true, class: 'form-check-input' %>
            <% else %>
              <%= check_box_tag 'exclude_days[]', day, false, class: 'form-check-input' %>
            <% end %>
            <label class="form-check-label" for="inlineCheckbox1">&nbsp;<%= day %></label>
          </div>
        <% end %>
      </div>
      <div class="row">
        <%= hidden_field_tag 'raw_schedule', @raw_schedule %>
        <%= submit_tag 'ReNew', class: 'contact1-form-btn' %>
      </div>
    <% end %>
</div>

<script type="text/javascript">
function mergeDuplicateRows() {
  const previousRow = {};
  const colsChanged = {};

  Array.from(document.querySelectorAll('tbody tr')).forEach((tr, rowIdx) => {
    Array.from(tr.children).forEach((td, colIdx) => {
      if (rowIdx > 0 && previousRow[colIdx].text === td.innerText) {
        previousRow[colIdx].elem.setAttribute('rowspan', ++previousRow[colIdx].span);
        colsChanged[colIdx] = false;
        td.remove();
      } else {
        previousRow[colIdx] = { span: 1, text: td.innerText, elem: td};
        colsChanged[colIdx] = true;
      }
    });
  });
}
mergeDuplicateRows();
</script>